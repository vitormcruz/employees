image: gitlab/dind

before_script:
  - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY

tests:

  script:
    - docker build --pull -t vitormcruz/employees .
    - docker run vitormcruz/employees 
    - docker tag vitormcruz/employees $CI_REGISTRY/vitormcruz/employees
    - docker tag vitormcruz/employees snapshot
    - docker tag vitormcruz/employees "$(git log -1 --pretty=%H)"
    - docker push $CI_REGISTRY/vitormcruz/employees 